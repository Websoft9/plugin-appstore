{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { useRef } from \"react\";\nimport { equal } from \"@wry/equality\";\nimport { mergeDeepArray } from \"../../utilities/index.js\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nimport { useSyncExternalStore } from \"./useSyncExternalStore.js\";\nexport function useFragment_experimental(options) {\n  var cache = useApolloClient().cache;\n  var fragment = options.fragment,\n    fragmentName = options.fragmentName,\n    from = options.from,\n    _a = options.optimistic,\n    optimistic = _a === void 0 ? true : _a,\n    rest = __rest(options, [\"fragment\", \"fragmentName\", \"from\", \"optimistic\"]);\n  var diffOptions = __assign(__assign({}, rest), {\n    id: typeof from === \"string\" ? from : cache.identify(from),\n    query: cache[\"getFragmentDoc\"](fragment, fragmentName),\n    optimistic: optimistic\n  });\n  var resultRef = useRef();\n  var latestDiff = cache.diff(diffOptions);\n  var getSnapshot = function getSnapshot() {\n    var latestDiffToResult = diffToResult(latestDiff);\n    return resultRef.current && equal(resultRef.current.data, latestDiffToResult.data) ? resultRef.current : resultRef.current = latestDiffToResult;\n  };\n  return useSyncExternalStore(function (forceUpdate) {\n    return cache.watch(__assign(__assign({}, diffOptions), {\n      immediate: true,\n      callback: function callback(diff) {\n        if (!equal(diff, latestDiff)) {\n          resultRef.current = diffToResult(latestDiff = diff);\n          forceUpdate();\n        }\n      }\n    }));\n  }, getSnapshot, getSnapshot);\n}\nfunction diffToResult(diff) {\n  var result = {\n    data: diff.result,\n    complete: !!diff.complete\n  };\n  if (diff.missing) {\n    result.missing = mergeDeepArray(diff.missing.map(function (error) {\n      return error.missing;\n    }));\n  }\n  return result;\n}","map":{"version":3,"names":["useRef","equal","mergeDeepArray","useApolloClient","useSyncExternalStore","useFragment_experimental","options","cache","fragment","fragmentName","from","_a","optimistic","rest","__rest","diffOptions","__assign","id","identify","query","resultRef","latestDiff","diff","getSnapshot","latestDiffToResult","diffToResult","current","data","forceUpdate","watch","immediate","callback","result","complete","missing","map","error"],"sources":["/data/stackhub-web/plugins/myapps/node_modules/@apollo/src/react/hooks/useFragment.ts"],"sourcesContent":["import { useRef } from \"react\";\nimport { equal } from \"@wry/equality\";\n\nimport { mergeDeepArray } from \"../../utilities\";\nimport {\n  Cache,\n  Reference,\n  StoreObject,\n  MissingTree,\n} from \"../../cache\";\n\nimport { useApolloClient } from \"./useApolloClient\";\nimport { useSyncExternalStore } from \"./useSyncExternalStore\";\nimport { OperationVariables } from \"../../core\";\n\nexport interface UseFragmentOptions<TData, TVars>\nextends Omit<\n  Cache.DiffOptions<TData, TVars>,\n  | \"id\"\n  | \"query\"\n  | \"optimistic\"\n  | \"previousResult\"\n  | \"returnPartialData\"\n>, Omit<Cache.ReadFragmentOptions<TData, TVars>,\n  | \"id\"\n  | \"returnPartialData\"\n> {\n  from: StoreObject | Reference | string;\n  // Override this field to make it optional (default: true).\n  optimistic?: boolean;\n\n  /**\n   * Whether to return incomplete data rather than null.\n   * Defaults to `true`.\n   * @deprecated This option will be removed in Apollo Client 3.8.\n   * Please check `result.missing` instead.\n   */\n  returnPartialData?: boolean;\n}\n\n// Since the above definition of UseFragmentOptions can be hard to parse without\n// help from TypeScript/VSCode, here are the intended fields and their types.\n// Uncomment this code to check that it's consistent with the definition above.\n//\n// export interface UseFragmentOptions<TData, TVars> {\n//   from: string | StoreObject | Reference;\n//   fragment: DocumentNode | TypedDocumentNode<TData, TVars>;\n//   fragmentName?: string;\n//   optimistic?: boolean;\n//   variables?: TVars;\n//   returnPartialData?: boolean;\n//   canonizeResults?: boolean;\n// }\n\nexport interface UseFragmentResult<TData> {\n  data: TData | undefined;\n  complete: boolean;\n  missing?: MissingTree;\n}\n\nexport function useFragment_experimental<\n  TData = any,\n  TVars = OperationVariables\n>(\n  options: UseFragmentOptions<TData, TVars>,\n): UseFragmentResult<TData> {\n  const { cache } = useApolloClient();\n\n  const {\n    fragment,\n    fragmentName,\n    from,\n    optimistic = true,\n    ...rest\n  } = options;\n\n  const diffOptions: Cache.DiffOptions<TData, TVars> = {\n    ...rest,\n    id: typeof from === \"string\" ? from : cache.identify(from),\n    query: cache[\"getFragmentDoc\"](fragment, fragmentName),\n    optimistic,\n  };\n\n  const resultRef = useRef<UseFragmentResult<TData>>();\n  let latestDiff = cache.diff<TData>(diffOptions);\n\n  // Used for both getSnapshot and getServerSnapshot\n  const getSnapshot = () => {\n    const latestDiffToResult = diffToResult(latestDiff);\n    return resultRef.current &&\n      equal(resultRef.current.data, latestDiffToResult.data)\n      ? resultRef.current\n      : (resultRef.current = latestDiffToResult);\n  };\n\n  return useSyncExternalStore(\n    (forceUpdate) => {\n      return cache.watch({\n        ...diffOptions,\n        immediate: true,\n        callback(diff) {\n          if (!equal(diff, latestDiff)) {\n            resultRef.current = diffToResult((latestDiff = diff));\n            forceUpdate();\n          }\n        },\n      });\n    },\n    getSnapshot,\n    getSnapshot\n  );\n}\n\nfunction diffToResult<TData>(\n  diff: Cache.DiffResult<TData>,\n): UseFragmentResult<TData> {\n  const result: UseFragmentResult<TData> = {\n    data: diff.result,\n    complete: !!diff.complete,\n  };\n\n  if (diff.missing) {\n    result.missing = mergeDeepArray(\n      diff.missing.map(error => error.missing),\n    );\n  }\n\n  return result;\n}\n"],"mappings":";AAAA,SAASA,MAAM,QAAQ,OAAO;AAC9B,SAASC,KAAK,QAAQ,eAAe;AAErC,SAASC,cAAc,QAAQ,0BAAkB;AAQjD,SAASC,eAAe,QAAQ,sBAAoB;AACpD,SAASC,oBAAoB,QAAQ,2BAAyB;AAgD9D,OAAM,SAAUC,wBAAwBA,CAItCC,OAAyC;EAEjC,IAAAC,KAAK,GAAKJ,eAAe,EAAE,CAAAI,KAAtB;EAGX,IAAAC,QAAQ,GAKNF,OAAO,CAAAE,QALD;IACRC,YAAY,GAIVH,OAAO,CAAAG,YAJG;IACZC,IAAI,GAGFJ,OAAO,CAAAI,IAHL;IACJC,EAAA,GAEEL,OAAO,CAAAM,UAFQ;IAAjBA,UAAU,GAAAD,EAAA,cAAG,IAAI,GAAAA,EAAA;IACdE,IAAI,GAAAC,MAAA,CACLR,OAAO,EANL,kDAML,CADQ;EAGT,IAAMS,WAAW,GAAAC,QAAA,CAAAA,QAAA,KACZH,IAAI;IACPI,EAAE,EAAE,OAAOP,IAAI,KAAK,QAAQ,GAAGA,IAAI,GAAGH,KAAK,CAACW,QAAQ,CAACR,IAAI,CAAC;IAC1DS,KAAK,EAAEZ,KAAK,CAAC,gBAAgB,CAAC,CAACC,QAAQ,EAAEC,YAAY,CAAC;IACtDG,UAAU,EAAAA;EAAA,EACX;EAED,IAAMQ,SAAS,GAAGpB,MAAM,EAA4B;EACpD,IAAIqB,UAAU,GAAGd,KAAK,CAACe,IAAI,CAAQP,WAAW,CAAC;EAG/C,IAAMQ,WAAW,GAAG,SAAdA,WAAWA,CAAA,EAAG;IAClB,IAAMC,kBAAkB,GAAGC,YAAY,CAACJ,UAAU,CAAC;IACnD,OAAOD,SAAS,CAACM,OAAO,IACtBzB,KAAK,CAACmB,SAAS,CAACM,OAAO,CAACC,IAAI,EAAEH,kBAAkB,CAACG,IAAI,CAAC,GACpDP,SAAS,CAACM,OAAO,GAChBN,SAAS,CAACM,OAAO,GAAGF,kBAAmB;EAC9C,CAAC;EAED,OAAOpB,oBAAoB,CACzB,UAACwB,WAAW;IACV,OAAOrB,KAAK,CAACsB,KAAK,CAAAb,QAAA,CAAAA,QAAA,KACbD,WAAW;MACde,SAAS,EAAE,IAAI;MACfC,QAAQ,WAAAA,SAACT,IAAI;QACX,IAAI,CAACrB,KAAK,CAACqB,IAAI,EAAED,UAAU,CAAC,EAAE;UAC5BD,SAAS,CAACM,OAAO,GAAGD,YAAY,CAAEJ,UAAU,GAAGC,IAAK,CAAC;UACrDM,WAAW,EAAE;;MAEjB;IAAC,GACD;EACJ,CAAC,EACDL,WAAW,EACXA,WAAW,CACZ;AACH;AAEA,SAASE,YAAYA,CACnBH,IAA6B;EAE7B,IAAMU,MAAM,GAA6B;IACvCL,IAAI,EAAEL,IAAI,CAACU,MAAM;IACjBC,QAAQ,EAAE,CAAC,CAACX,IAAI,CAACW;GAClB;EAED,IAAIX,IAAI,CAACY,OAAO,EAAE;IAChBF,MAAM,CAACE,OAAO,GAAGhC,cAAc,CAC7BoB,IAAI,CAACY,OAAO,CAACC,GAAG,CAAC,UAAAC,KAAK;MAAI,OAAAA,KAAK,CAACF,OAAO;IAAb,CAAa,CAAC,CACzC;;EAGH,OAAOF,MAAM;AACf"},"metadata":{},"sourceType":"module","externalDependencies":[]}