{"ast":null,"code":"import _regeneratorRuntime from\"/data/stackhub-web/plugins/myapps/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _createClass from\"/data/stackhub-web/plugins/myapps/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/data/stackhub-web/plugins/myapps/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _asyncToGenerator from\"/data/stackhub-web/plugins/myapps/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';import{Navigate}from\"react-router-dom\";// 定义一个全局变量来存储 config.json 的内容\nimport{jsx as _jsx}from\"react/jsx-runtime\";var credentials;function getCredentials(){return _getCredentials.apply(this,arguments);}// 设置 axios 的默认配置\nfunction _getCredentials(){_getCredentials=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var response,data,userName,uerPassword;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(credentials){_context3.next=10;break;}_context3.next=3;return fetch('./config.json');case 3:response=_context3.sent;_context3.next=6;return response.json();case 6:data=_context3.sent;userName=data.APPMANAGE.APPMANAGE_USERNAME;uerPassword=data.APPMANAGE.APPMANAGE_PASSWORD;credentials=btoa(userName+\":\"+uerPassword);case 10:return _context3.abrupt(\"return\",credentials);case 11:case\"end\":return _context3.stop();}},_callee3);}));return _getCredentials.apply(this,arguments);}axios.defaults.headers.post['Content-Type']='application/json';axios.defaults.headers.get['Content-Type']='application/json';axios.defaults.headers.common['Cache-Control']='no-cache';axios.defaults.headers.common['Pragma']='no-cache';axios.defaults.headers.common['Expires']='0';// 拦截响应以捕获错误\naxios.interceptors.response.use(function(response){return response;},function(error){// 任何不在 2xx 范围内的状态码都会触发这个函数\nvar message;if(error&&error.response&&error.response.status===404){/*#__PURE__*/_jsx(Navigate,{to:\"/error-404\"});}else if(error&&error.response&&error.response.status===500){/*#__PURE__*/_jsx(Navigate,{to:\"/error-500\"});}else{message=error.response&&error.response.data?error.response.data['message']:error.message||error;return Promise.reject(message);}});var APICore=/*#__PURE__*/_createClass(function APICore(){_classCallCheck(this,APICore);/**\n    * Fetches data from given url\n    */this.get=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(url,params){var response,queryString;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return getCredentials();case 2:_context.t0=_context.sent;axios.defaults.headers.common['Authorization']='Basic '+_context.t0;if(params){queryString=params?Object.keys(params).map(function(key){return key+'='+params[key];}).join('&'):'';response=axios.get(\"\".concat(url,\"?\").concat(queryString),params);}else{response=axios.get(\"\".concat(url),params);}return _context.abrupt(\"return\",response);case 6:case\"end\":return _context.stop();}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();/**\n    * post given data to url\n    */this.create=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(url,data){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getCredentials();case 2:_context2.t0=_context2.sent;axios.defaults.headers.common['Authorization']='Basic '+_context2.t0;return _context2.abrupt(\"return\",axios.post(url,data));case 5:case\"end\":return _context2.stop();}},_callee2);}));return function(_x3,_x4){return _ref2.apply(this,arguments);};}();});export{APICore};","map":{"version":3,"names":["axios","Navigate","jsx","_jsx","credentials","getCredentials","_getCredentials","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee3","response","data","userName","uerPassword","wrap","_callee3$","_context3","prev","next","fetch","sent","json","APPMANAGE","APPMANAGE_USERNAME","APPMANAGE_PASSWORD","btoa","abrupt","stop","defaults","headers","post","get","common","interceptors","use","error","message","status","to","Promise","reject","APICore","_createClass","_classCallCheck","_ref","_callee","url","params","queryString","_callee$","_context","t0","Object","keys","map","key","join","concat","_x","_x2","create","_ref2","_callee2","_callee2$","_context2","_x3","_x4"],"sources":["/data/stackhub-web/plugins/myapps/src/helpers/api/apiCore.js"],"sourcesContent":["import axios from 'axios';\nimport { Navigate } from \"react-router-dom\";\n\n// 定义一个全局变量来存储 config.json 的内容\nlet credentials;\n\nasync function getCredentials() {\n    // 如果 credentials 不存在，就从 config.json 中获取它\n    if (!credentials) {\n        const response = await fetch('./config.json');\n        const data = await response.json();\n        const userName = data.APPMANAGE.APPMANAGE_USERNAME;\n        const uerPassword = data.APPMANAGE.APPMANAGE_PASSWORD;\n        credentials = btoa(userName + \":\" + uerPassword);\n    }\n    // 返回 credentials\n    return credentials;\n}\n\n// 设置 axios 的默认配置\naxios.defaults.headers.post['Content-Type'] = 'application/json';\naxios.defaults.headers.get['Content-Type'] = 'application/json';\naxios.defaults.headers.common['Cache-Control'] = 'no-cache';\naxios.defaults.headers.common['Pragma'] = 'no-cache';\naxios.defaults.headers.common['Expires'] = '0';\n\n// 拦截响应以捕获错误\naxios.interceptors.response.use(\n    (response) => {\n        return response;\n    },\n    (error) => {\n        // 任何不在 2xx 范围内的状态码都会触发这个函数\n        let message;\n\n        if (error && error.response && error.response.status === 404) {\n            <Navigate to=\"/error-404\" />\n        } else if (error && error.response && error.response.status === 500) {\n            <Navigate to=\"/error-500\" />\n        } else {\n            message = error.response && error.response.data ? error.response.data['message'] : error.message || error;\n            return Promise.reject(message);\n        }\n    }\n);\n\nclass APICore {\n    /**\n    * Fetches data from given url\n    */\n    get = async (url, params) => {\n        // 等待获取凭证并设置授权头\n        axios.defaults.headers.common['Authorization'] = 'Basic ' + await getCredentials();\n        let response;\n        if (params) {\n            var queryString = params\n                ? Object.keys(params)\n                    .map((key) => key + '=' + params[key])\n                    .join('&')\n                : '';\n            response = axios.get(`${url}?${queryString}`, params);\n        } else {\n            response = axios.get(`${url}`, params);\n        }\n        return response;\n    };\n\n    /**\n    * post given data to url\n    */\n    create = async (url, data) => {\n        // 等待获取凭证并设置授权头\n        axios.defaults.headers.common['Authorization'] = 'Basic ' + await getCredentials();\n        return axios.post(url, data);\n    };\n}\n\nexport { APICore };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}