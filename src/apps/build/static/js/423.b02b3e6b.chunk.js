(self.webpackChunkapps=self.webpackChunkapps||[]).push([[423],{31371:function(){function e(){var e;("all"==window.debugging||null!==(e=window.debugging)&&void 0!==e&&e.includes("style"))&&console.debug(["cockpit-dark-theme: ".concat(document.documentElement.id,":")].concat(Array.prototype.slice.call(arguments)).join(" "))}function t(t){var n,i,s,o=t||localStorage.getItem("shell:style")||"auto";s=!!(null!==(n=(i=window).matchMedia)&&void 0!==n&&n.call(i,"(prefers-color-scheme: dark)").matches&&"auto"===o||"dark"===o),function(t,n){e("Setting cockpit theme to ".concat(n?"dark":"light")),n?t.classList.add("pf-theme-dark"):t.classList.remove("pf-theme-dark")}(document.documentElement,s)}window.addEventListener("storage",(function(n){"shell:style"===n.key&&(e("Storage element 'shell:style' changed from  ".concat(n.oldValue," to ").concat(n.newValue)),t())})),window.addEventListener("cockpit-style",(function(n){var i=n.detail.style;e("Event received from shell with 'cockpit-style'  ".concat(i)),t(i)})),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(){var n,i;e("Operating system theme preference changed to ".concat(null!==(n=(i=window).matchMedia)&&void 0!==n&&n.call(i,"(prefers-color-scheme: dark)").matches?"dark":"light")),t()})),t()},22423:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var i=n(72791),s=n(15671),o=n(43144),a=n(97326),r=n(60136),l=n(27277),c=n(52136),h=n(62968),u=n(78955),d=n(97695),m=n(90146),f=n(49061),v=n(70433),g=n(37346),p=n.n(g),b=n(72187),k=n(76396),w=n(32699),x=n(55249),C=n(29439),y=n(80184),z=p().gettext,T=function(e){var t=e.parentId,n=e.getText,s=e.setText,o=i.useState(!1),a=(0,C.Z)(o,2),r=a[0],l=a[1],c=i.useState(null),h=(0,C.Z)(c,2),u=h[0],d=h[1],m=i.useRef(null);return i.useEffect((function(){var e=function(e){e.preventDefault(),l(!0),d(e)},n=function(e){e&&0===e.button&&(!(e.target.contains===m.current)&&l(!1))},i=document.getElementById(t);return i.addEventListener("contextmenu",e),document.addEventListener("click",n),function(){i.removeEventListener("contextmenu",e),document.removeEventListener("click",n)}}),[t]),i.useEffect((function(){if(u){var e=u.clientX,t=u.clientY,n=window.innerWidth,i=window.innerHeight,s=m.current.offsetWidth,o=m.current.offsetHeight,a=n-e>s,r=!a,l=i-t>o,c=!l;a&&(m.current.style.left="".concat(e+5,"px")),r&&(m.current.style.left="".concat(e-s-5,"px")),l&&(m.current.style.top="".concat(t+5,"px")),c&&(m.current.style.top="".concat(t-o-5,"px"))}}),[u]),r&&(0,y.jsxs)("div",{ref:m,className:"contextMenu",children:[(0,y.jsxs)("button",{className:"contextMenuOption",onClick:n,children:[(0,y.jsxs)("div",{className:"contextMenuName",children:[" ",z("Copy")," "]}),(0,y.jsx)("div",{className:"contextMenuShortcut",children:z("Ctrl+Insert")})]}),(0,y.jsxs)("button",{className:"contextMenuOption",onClick:s,children:[(0,y.jsxs)("div",{className:"contextMenuName",children:[" ",z("Paste")," "]}),(0,y.jsx)("div",{className:"contextMenuShortcut",children:z("Shift+Insert")})]})]})},S=p().gettext,j={yellow:"#b58900",brightRed:"#cb4b16",red:"#dc322f",magenta:"#d33682",brightMagenta:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"},M={"black-theme":{background:"#000000",foreground:"#ffffff"},"dark-theme":Object.assign({},j,{background:"#002b36",foreground:"#fdf6e3",cursor:"#eee8d5",selection:"#ffffff77",brightBlack:"#002b36",black:"#073642",brightGreen:"#586e75",brightYellow:"#657b83",brightBlue:"#839496",brightCyan:"#93a1a1",white:"#eee8d5",brightWhite:"#fdf6e3"}),"light-theme":Object.assign({},j,{background:"#fdf6e3",foreground:"#002b36",cursor:"#073642",selection:"#00000044",brightWhite:"#002b36",white:"#073642",brightCyan:"#586e75",brightBlue:"#657b83",brightYellow:"#839496",brightGreen:"#93a1a1",black:"#eee8d5",brightBlack:"#fdf6e3"}),"white-theme":{background:"#ffffff",foreground:"#000000",selection:"#00000044",cursor:"#000000"}},R=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;(0,s.Z)(this,n),(o=t.call(this,e)).onChannelMessage=o.onChannelMessage.bind((0,a.Z)(o)),o.onChannelClose=o.onChannelClose.bind((0,a.Z)(o)),o.connectChannel=o.connectChannel.bind((0,a.Z)(o)),o.disconnectChannel=o.disconnectChannel.bind((0,a.Z)(o)),o.reset=o.reset.bind((0,a.Z)(o)),o.focus=o.focus.bind((0,a.Z)(o)),o.onWindowResize=o.onWindowResize.bind((0,a.Z)(o)),o.resizeTerminal=o.resizeTerminal.bind((0,a.Z)(o)),o.onFocusIn=o.onFocusIn.bind((0,a.Z)(o)),o.onFocusOut=o.onFocusOut.bind((0,a.Z)(o)),o.setText=o.setText.bind((0,a.Z)(o)),o.getText=o.getText.bind((0,a.Z)(o)),o.setTerminalTheme=o.setTerminalTheme.bind((0,a.Z)(o));var r=new w.Terminal({cols:e.cols||80,rows:e.rows||25,screenKeys:!0,cursorBlink:!0,fontSize:e.fontSize||16,fontFamily:"Menlo, Monaco, Consolas, monospace",screenReaderMode:!0,showPastingModal:!1});return o.terminalRef=i.createRef(),r.onData(function(e){this.props.channel.valid&&this.props.channel.send(e)}.bind((0,a.Z)(o))),e.onTitleChanged&&r.onTitleChange(e.onTitleChanged),o.terminal=r,o.state={showPastingModal:!1,cols:e.cols||80,rows:e.rows||25},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.terminal.open(this.terminalRef.current),this.terminal.loadAddon(new x.CanvasAddon),this.connectChannel(),this.props.rows||(window.addEventListener("resize",this.onWindowResize),this.onWindowResize()),this.setTerminalTheme(this.props.theme||"black-theme"),this.terminal.focus()}},{key:"resizeTerminal",value:function(e,t){this.terminal.resize(e,t),this.props.channel.control({window:{rows:t,cols:e}})}},{key:"componentDidUpdate",value:function(e,t){if(e.fontSize!==this.props.fontSize){this.terminal.options.fontSize=this.props.fontSize;var n=this.calculateDimensions();n.cols!==this.state.cols||n.rows!==this.state.rows?this.onWindowResize():this.resizeTerminal(n.cols-1,n.rows)}t.cols===this.state.cols&&t.rows===this.state.rows||this.resizeTerminal(this.state.cols,this.state.rows),e.theme!==this.props.theme&&this.setTerminalTheme(this.props.theme),e.channel!==this.props.channel&&(this.terminal.reset(),this.disconnectChannel(e.channel),this.connectChannel(),this.props.channel.control({window:{rows:this.state.rows,cols:this.state.cols}})),this.terminal.focus()}},{key:"render",value:function(){var e=this;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(b.u,{title:S("Paste error"),position:"top",variant:"small",isOpen:this.state.showPastingModal,onClose:function(){return e.setState({showPastingModal:!1})},actions:[(0,y.jsx)(k.zx,{variant:"secondary",onClick:function(){return e.setState({showPastingModal:!1})},children:S("Close")},"cancel")],children:S("Your browser does not allow paste from the context menu. You can use Shift+Insert.")}),(0,y.jsx)("div",{ref:this.terminalRef,className:"console-ct",onFocus:this.onFocusIn,onContextMenu:this.contextMenu,onBlur:this.onFocusOut},this.terminal),(0,y.jsx)(T,{parentId:this.props.parentId,setText:this.setText,getText:this.getText})]})}},{key:"componentWillUnmount",value:function(){this.disconnectChannel(),this.terminal.dispose(),window.removeEventListener("resize",this.onWindowResize),this.onFocusOut()}},{key:"setText",value:function(){var e=this;try{navigator.clipboard.readText().then((function(t){return e.props.channel.send(t)})).catch((function(t){return e.setState({showPastingModal:!0})})).finally((function(){return e.terminal.focus()}))}catch(t){this.setState({showPastingModal:!0})}}},{key:"getText",value:function(){var e=this;try{navigator.clipboard.writeText(this.terminal.getSelection()).catch((function(e){return console.error("Text could not be copied, use Ctrl+Insert ",e?e.toString():"")})).finally((function(){return e.terminal.focus()}))}catch(t){console.error("Text could not be copied, use Ctrl+Insert:",t.toString())}}},{key:"onChannelMessage",value:function(e,t){this.terminal.write(t)}},{key:"onChannelClose",value:function(e,t){var n=this.terminal;n.write("\x1b[31m"+(t.problem||"disconnected")+"\x1b[m\r\n"),n.cursorHidden=!0,n.refresh(n.rows,n.rows)}},{key:"connectChannel",value:function(){var e=this.props.channel;null!==e&&void 0!==e&&e.valid&&(e.addEventListener("message",this.onChannelMessage.bind(this)),e.addEventListener("close",this.onChannelClose.bind(this)),e.send(this.props.runCmd),this.reset())}},{key:"disconnectChannel",value:function(e){void 0===e&&(e=this.props.channel),e&&(e.removeEventListener("message",this.onChannelMessage),e.removeEventListener("close",this.onChannelClose)),e.close()}},{key:"reset",value:function(){this.terminal.reset(),this.props.channel.send(String.fromCharCode(12))}},{key:"focus",value:function(){this.terminal&&this.terminal.focus()}},{key:"calculateDimensions",value:function(){var e=this.terminal._core._renderService.dimensions.css.cell.height,t=this.terminal._core._renderService.dimensions.css.cell.width;return e&&t&&0!==t&&0!==e?{rows:Math.floor((this.terminalRef.current.parentElement.clientHeight-10)/e),cols:Math.floor((this.terminalRef.current.parentElement.clientWidth-10-12)/t)}:{rows:this.state.rows,cols:this.state.cols}}},{key:"onWindowResize",value:function(){this.setState(this.calculateDimensions())}},{key:"setTerminalTheme",value:function(e){this.terminal.options.theme=M[e]}},{key:"onBeforeUnload",value:function(e){return e.preventDefault(),e.returnValue="",""}},{key:"onFocusIn",value:function(){window.addEventListener("beforeunload",this.onBeforeUnload)}},{key:"onFocusOut",value:function(){window.removeEventListener("beforeunload",this.onBeforeUnload)}}]),n}(i.Component),E=(n(31371),p().gettext);p().translate();var Z=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;(0,s.Z)(this,n),o=t.call(this,e);var r=localStorage.getItem("terminal:theme"),l=localStorage.getItem("terminal:font-size");return null!==r&&""!==r||""!==(r=document.cookie.replace(/(?:(?:^|.*;\s*)theme_cookie\s*=\s*([^;]*).*$)|^.*$/,"$1"))&&(localStorage.setItem("terminal:theme",r),o.invalidateCookie("theme_cookie")),null!==l&&""!==l||""!==(l=document.cookie.replace(/(?:(?:^|.*;\s*)size_cookie\s*=\s*([^;]*).*$)|^.*$/,"$1"))&&(localStorage.setItem("terminal:font-size",l),o.invalidateCookie("size_cookie")),o.state={title:"Terminal",theme:r||"black-theme",size:parseInt(l)||16},o.onTitleChanged=o.onTitleChanged.bind((0,a.Z)(o)),o.onResetClick=o.onResetClick.bind((0,a.Z)(o)),o.onThemeChanged=o.onThemeChanged.bind((0,a.Z)(o)),o.onPlus=o.onPlus.bind((0,a.Z)(o)),o.onMinus=o.onMinus.bind((0,a.Z)(o)),o.terminalRef=i.createRef(),o.resetButtonRef=i.createRef(),o.minSize=6,o.maxSize=40,o}return(0,o.Z)(n,[{key:"createChannel",value:function(e){return p().channel({payload:"stream",spawn:[e.shell||"/bin/bash"],environ:["TERM=xterm-256color"],directory:e.home||"/",pty:!0})}},{key:"componentDidMount",value:function(){p().user().done(function(e){this.setState({user:e,channel:this.createChannel(e)})}.bind(this))}},{key:"onTitleChanged",value:function(e){this.setState({title:e})}},{key:"invalidateCookie",value:function(e){var t=e+"=''; path=/; Max-Age=0;";document.cookie=t}},{key:"onPlus",value:function(){this.setState((function(e,t){return localStorage.setItem("terminal:font-size",e.size+1),{size:e.size+1}}))}},{key:"onMinus",value:function(){this.setState((function(e,t){return localStorage.setItem("terminal:font-size",e.size-1),{size:e.size-1}}))}},{key:"onThemeChanged",value:function(e){this.setState({theme:e}),localStorage.setItem("terminal:theme",e)}},{key:"onResetClick",value:function(e){var t=this;0===e.button&&(!this.state.channel.valid&&this.state.user?this.setState((function(e){return{channel:t.createChannel(e.user)}})):this.terminalRef.current.reset(),this.resetButtonRef.current.blur(),this.terminalRef.current.focus())}},{key:"render",value:function(){var e=this.state.channel?(0,y.jsx)(R,{ref:this.terminalRef,channel:this.state.channel,theme:this.state.theme,fontSize:this.state.size,parentId:"the-terminal",onTitleChanged:this.onTitleChanged,runCmd:this.props.runCmd}):(0,y.jsx)("span",{children:"Loading..."});return(0,y.jsxs)("div",{className:"console-ct-container",children:[(0,y.jsxs)("div",{className:"terminal-group",children:[(0,y.jsx)("tt",{className:"terminal-title"}),(0,y.jsx)(c.o,{id:"toolbar",children:(0,y.jsxs)(h.c,{children:[(0,y.jsxs)(u.k,{children:[(0,y.jsx)(d.E,{variant:"label",id:"size-select",children:E("Font size")}),(0,y.jsx)(d.E,{children:(0,y.jsx)(m.Y,{className:"font-size",value:this.state.size,min:this.minSize,max:this.maxSize,onMinus:this.onMinus,onPlus:this.onPlus,inputAriaLabel:E("Font size"),minusBtnAriaLabel:E("Decrease by one"),plusBtnAriaLabel:E("Increase by one"),widthChars:2})})]}),(0,y.jsxs)(u.k,{children:[(0,y.jsx)(d.E,{variant:"label",id:"theme-select",children:E("Appearance")}),(0,y.jsx)(d.E,{children:(0,y.jsxs)(f.i,{id:"select-theme",onChange:this.onThemeChanged,"aria-labelledby":"theme-select",value:this.state.theme,children:[(0,y.jsx)(v.j,{value:"black-theme",label:E("Black")}),(0,y.jsx)(v.j,{value:"dark-theme",label:E("Dark")}),(0,y.jsx)(v.j,{value:"light-theme",label:E("Light")}),(0,y.jsx)(v.j,{value:"white-theme",label:E("White")})]})})]}),(0,y.jsx)(d.E,{children:(0,y.jsx)("button",{ref:this.resetButtonRef,className:"pf-c-button pf-m-secondary terminal-reset",onClick:this.onResetClick,children:E("Reset")})})]})})]}),(0,y.jsx)("div",{className:"terminal-body "+this.state.theme,id:"the-terminal",children:e})]})}}]),n}(i.Component),I=Z,L=function(e){return(0,y.jsx)("div",{className:"ct-page-fill",id:"terminal",children:(0,y.jsx)(I,{runCmd:"docker exec -it ".concat(e.data.customer_name," bash || sh\n")})})}}}]);
//# sourceMappingURL=423.b02b3e6b.chunk.js.map