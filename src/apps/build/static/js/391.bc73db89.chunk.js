"use strict";(self.webpackChunkapps=self.webpackChunkapps||[]).push([[391],{1391:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var s=n(2791),i=n(5671),o=n(3144),a=n(7326),r=n(136),l=n(7277),c=n(2136),h=n(2968),u=n(8955),d=n(7695),m=n(146),f=n(9061),v=n(433),b=n(7346),p=n.n(b),g=n(2187),x=n(6396),k=n(2699),C=n(5249),w=n(9439),y=n(184),z=p().gettext,T=function(e){var t=e.parentId,n=e.getText,i=e.setText,o=s.useState(!1),a=(0,w.Z)(o,2),r=a[0],l=a[1],c=s.useState(null),h=(0,w.Z)(c,2),u=h[0],d=h[1],m=s.useRef(null);return s.useEffect((function(){var e=function(e){e.preventDefault(),l(!0),d(e)},n=function(e){e&&0===e.button&&(!(e.target.contains===m.current)&&l(!1))},s=document.getElementById(t);return s.addEventListener("contextmenu",e),document.addEventListener("click",n),function(){s.removeEventListener("contextmenu",e),document.removeEventListener("click",n)}}),[t]),s.useEffect((function(){if(u){var e=u.clientX,t=u.clientY,n=window.innerWidth,s=window.innerHeight,i=m.current.offsetWidth,o=m.current.offsetHeight,a=n-e>i,r=!a,l=s-t>o,c=!l;a&&(m.current.style.left="".concat(e+5,"px")),r&&(m.current.style.left="".concat(e-i-5,"px")),l&&(m.current.style.top="".concat(t+5,"px")),c&&(m.current.style.top="".concat(t-o-5,"px"))}}),[u]),r&&(0,y.jsxs)("div",{ref:m,className:"contextMenu",children:[(0,y.jsxs)("button",{className:"contextMenuOption",onClick:n,children:[(0,y.jsxs)("div",{className:"contextMenuName",children:[" ",z("Copy")," "]}),(0,y.jsx)("div",{className:"contextMenuShortcut",children:z("Ctrl+Insert")})]}),(0,y.jsxs)("button",{className:"contextMenuOption",onClick:i,children:[(0,y.jsxs)("div",{className:"contextMenuName",children:[" ",z("Paste")," "]}),(0,y.jsx)("div",{className:"contextMenuShortcut",children:z("Shift+Insert")})]})]})},j=p().gettext,S={yellow:"#b58900",brightRed:"#cb4b16",red:"#dc322f",magenta:"#d33682",brightMagenta:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"},M={"black-theme":{background:"#000000",foreground:"#ffffff"},"dark-theme":Object.assign({},S,{background:"#002b36",foreground:"#fdf6e3",cursor:"#eee8d5",selection:"#ffffff77",brightBlack:"#002b36",black:"#073642",brightGreen:"#586e75",brightYellow:"#657b83",brightBlue:"#839496",brightCyan:"#93a1a1",white:"#eee8d5",brightWhite:"#fdf6e3"}),"light-theme":Object.assign({},S,{background:"#fdf6e3",foreground:"#002b36",cursor:"#073642",selection:"#00000044",brightWhite:"#002b36",white:"#073642",brightCyan:"#586e75",brightBlue:"#657b83",brightYellow:"#839496",brightGreen:"#93a1a1",black:"#eee8d5",brightBlack:"#fdf6e3"}),"white-theme":{background:"#ffffff",foreground:"#000000",selection:"#00000044",cursor:"#000000"}},R=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;(0,i.Z)(this,n),(o=t.call(this,e)).onChannelMessage=o.onChannelMessage.bind((0,a.Z)(o)),o.onChannelClose=o.onChannelClose.bind((0,a.Z)(o)),o.connectChannel=o.connectChannel.bind((0,a.Z)(o)),o.disconnectChannel=o.disconnectChannel.bind((0,a.Z)(o)),o.reset=o.reset.bind((0,a.Z)(o)),o.focus=o.focus.bind((0,a.Z)(o)),o.onWindowResize=o.onWindowResize.bind((0,a.Z)(o)),o.resizeTerminal=o.resizeTerminal.bind((0,a.Z)(o)),o.onFocusIn=o.onFocusIn.bind((0,a.Z)(o)),o.onFocusOut=o.onFocusOut.bind((0,a.Z)(o)),o.setText=o.setText.bind((0,a.Z)(o)),o.getText=o.getText.bind((0,a.Z)(o)),o.setTerminalTheme=o.setTerminalTheme.bind((0,a.Z)(o));var r=new k.Terminal({cols:e.cols||80,rows:e.rows||25,screenKeys:!0,cursorBlink:!0,fontSize:e.fontSize||16,fontFamily:"Menlo, Monaco, Consolas, monospace",screenReaderMode:!0,showPastingModal:!1});return o.terminalRef=s.createRef(),r.onData(function(e){this.props.channel.valid&&this.props.channel.send(e)}.bind((0,a.Z)(o))),e.onTitleChanged&&r.onTitleChange(e.onTitleChanged),o.terminal=r,o.state={showPastingModal:!1,cols:e.cols||80,rows:e.rows||25},o}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.terminal.open(this.terminalRef.current),this.terminal.loadAddon(new C.CanvasAddon),this.connectChannel(),this.props.rows||(window.addEventListener("resize",this.onWindowResize),this.onWindowResize()),this.setTerminalTheme(this.props.theme||"black-theme"),this.terminal.focus()}},{key:"resizeTerminal",value:function(e,t){this.terminal.resize(e,t),this.props.channel.control({window:{rows:t,cols:e}})}},{key:"componentDidUpdate",value:function(e,t){if(e.fontSize!==this.props.fontSize){this.terminal.options.fontSize=this.props.fontSize;var n=this.calculateDimensions();n.cols!==this.state.cols||n.rows!==this.state.rows?this.onWindowResize():this.resizeTerminal(n.cols-1,n.rows)}t.cols===this.state.cols&&t.rows===this.state.rows||this.resizeTerminal(this.state.cols,this.state.rows),e.theme!==this.props.theme&&this.setTerminalTheme(this.props.theme),e.channel!==this.props.channel&&(this.terminal.reset(),this.disconnectChannel(e.channel),this.connectChannel(),this.props.channel.control({window:{rows:this.state.rows,cols:this.state.cols}})),this.terminal.focus()}},{key:"render",value:function(){var e=this;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(g.u,{title:j("Paste error"),position:"top",variant:"small",isOpen:this.state.showPastingModal,onClose:function(){return e.setState({showPastingModal:!1})},actions:[(0,y.jsx)(x.zx,{variant:"secondary",onClick:function(){return e.setState({showPastingModal:!1})},children:j("Close")},"cancel")],children:j("Your browser does not allow paste from the context menu. You can use Shift+Insert.")}),(0,y.jsx)("div",{ref:this.terminalRef,className:"console-ct",onFocus:this.onFocusIn,onContextMenu:this.contextMenu,onBlur:this.onFocusOut},this.terminal),(0,y.jsx)(T,{parentId:this.props.parentId,setText:this.setText,getText:this.getText})]})}},{key:"componentWillUnmount",value:function(){this.disconnectChannel(),this.terminal.dispose(),window.removeEventListener("resize",this.onWindowResize),this.onFocusOut()}},{key:"setText",value:function(){var e=this;try{navigator.clipboard.readText().then((function(t){return e.props.channel.send(t)})).catch((function(t){return e.setState({showPastingModal:!0})})).finally((function(){return e.terminal.focus()}))}catch(t){this.setState({showPastingModal:!0})}}},{key:"getText",value:function(){var e=this;try{navigator.clipboard.writeText(this.terminal.getSelection()).catch((function(e){return console.error("Text could not be copied, use Ctrl+Insert ",e?e.toString():"")})).finally((function(){return e.terminal.focus()}))}catch(t){console.error("Text could not be copied, use Ctrl+Insert:",t.toString())}}},{key:"onChannelMessage",value:function(e,t){this.terminal.write(t)}},{key:"onChannelClose",value:function(e,t){var n=this.terminal;n.write("\x1b[31m"+(t.problem||"disconnected")+"\x1b[m\r\n"),n.cursorHidden=!0,n.refresh(n.rows,n.rows)}},{key:"connectChannel",value:function(){var e=this.props.channel;null!==e&&void 0!==e&&e.valid&&(e.send("docker exec -it mysql55 bash||sh\n"),e.addEventListener("message",this.onChannelMessage.bind(this)),e.addEventListener("close",this.onChannelClose.bind(this)))}},{key:"disconnectChannel",value:function(e){void 0===e&&(e=this.props.channel),e&&(e.removeEventListener("message",this.onChannelMessage),e.removeEventListener("close",this.onChannelClose)),e.close()}},{key:"reset",value:function(){this.terminal.reset(),this.props.channel.send(String.fromCharCode(12))}},{key:"focus",value:function(){this.terminal&&this.terminal.focus()}},{key:"calculateDimensions",value:function(){var e=this.terminal._core._renderService.dimensions.css.cell.height,t=this.terminal._core._renderService.dimensions.css.cell.width;return e&&t&&0!==t&&0!==e?{rows:Math.floor((this.terminalRef.current.parentElement.clientHeight-10)/e),cols:Math.floor((this.terminalRef.current.parentElement.clientWidth-10-12)/t)}:{rows:this.state.rows,cols:this.state.cols}}},{key:"onWindowResize",value:function(){this.setState(this.calculateDimensions())}},{key:"setTerminalTheme",value:function(e){this.terminal.options.theme=M[e]}},{key:"onBeforeUnload",value:function(e){return e.preventDefault(),e.returnValue="",""}},{key:"onFocusIn",value:function(){window.addEventListener("beforeunload",this.onBeforeUnload)}},{key:"onFocusOut",value:function(){window.removeEventListener("beforeunload",this.onBeforeUnload)}}]),n}(s.Component),Z=p().gettext;p().translate();var E=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;(0,i.Z)(this,n),o=t.call(this,e);var r=localStorage.getItem("terminal:theme"),l=localStorage.getItem("terminal:font-size");return null!==r&&""!==r||""!==(r=document.cookie.replace(/(?:(?:^|.*;\s*)theme_cookie\s*=\s*([^;]*).*$)|^.*$/,"$1"))&&(localStorage.setItem("terminal:theme",r),o.invalidateCookie("theme_cookie")),null!==l&&""!==l||""!==(l=document.cookie.replace(/(?:(?:^|.*;\s*)size_cookie\s*=\s*([^;]*).*$)|^.*$/,"$1"))&&(localStorage.setItem("terminal:font-size",l),o.invalidateCookie("size_cookie")),o.state={title:"Terminal",theme:r||"black-theme",size:parseInt(l)||16},o.onTitleChanged=o.onTitleChanged.bind((0,a.Z)(o)),o.onResetClick=o.onResetClick.bind((0,a.Z)(o)),o.onThemeChanged=o.onThemeChanged.bind((0,a.Z)(o)),o.onPlus=o.onPlus.bind((0,a.Z)(o)),o.onMinus=o.onMinus.bind((0,a.Z)(o)),o.terminalRef=s.createRef(),o.resetButtonRef=s.createRef(),o.minSize=6,o.maxSize=40,o}return(0,o.Z)(n,[{key:"createChannel",value:function(e){return p().channel({payload:"stream",spawn:[e.shell||"/bin/bash"],environ:["TERM=xterm-256color"],directory:e.home||"/",pty:!0})}},{key:"componentDidMount",value:function(){p().user().done(function(e){this.setState({user:e,channel:this.createChannel(e)})}.bind(this))}},{key:"onTitleChanged",value:function(e){this.setState({title:e})}},{key:"invalidateCookie",value:function(e){var t=e+"=''; path=/; Max-Age=0;";document.cookie=t}},{key:"onPlus",value:function(){this.setState((function(e,t){return localStorage.setItem("terminal:font-size",e.size+1),{size:e.size+1}}))}},{key:"onMinus",value:function(){this.setState((function(e,t){return localStorage.setItem("terminal:font-size",e.size-1),{size:e.size-1}}))}},{key:"onThemeChanged",value:function(e){this.setState({theme:e}),localStorage.setItem("terminal:theme",e)}},{key:"onResetClick",value:function(e){var t=this;0===e.button&&(!this.state.channel.valid&&this.state.user?this.setState((function(e){return{channel:t.createChannel(e.user)}})):this.terminalRef.current.reset(),this.resetButtonRef.current.blur(),this.terminalRef.current.focus())}},{key:"render",value:function(){var e=this.state.channel?(0,y.jsx)(R,{ref:this.terminalRef,channel:this.state.channel,theme:this.state.theme,fontSize:this.state.size,parentId:"the-terminal",onTitleChanged:this.onTitleChanged}):(0,y.jsx)("span",{children:"Loading..."});return(0,y.jsxs)("div",{className:"console-ct-container",children:[(0,y.jsxs)("div",{className:"terminal-group",children:[(0,y.jsx)("tt",{className:"terminal-title",children:this.state.title}),(0,y.jsx)(c.o,{id:"toolbar",children:(0,y.jsxs)(h.c,{children:[(0,y.jsxs)(u.k,{children:[(0,y.jsx)(d.E,{variant:"label",id:"size-select",children:Z("Font size")}),(0,y.jsx)(d.E,{children:(0,y.jsx)(m.Y,{className:"font-size",value:this.state.size,min:this.minSize,max:this.maxSize,onMinus:this.onMinus,onPlus:this.onPlus,inputAriaLabel:Z("Font size"),minusBtnAriaLabel:Z("Decrease by one"),plusBtnAriaLabel:Z("Increase by one"),widthChars:2})})]}),(0,y.jsxs)(u.k,{children:[(0,y.jsx)(d.E,{variant:"label",id:"theme-select",children:Z("Appearance")}),(0,y.jsx)(d.E,{children:(0,y.jsxs)(f.i,{onChange:this.onThemeChanged,"aria-labelledby":"theme-select",value:this.state.theme,children:[(0,y.jsx)(v.j,{value:"black-theme",label:Z("Black")}),(0,y.jsx)(v.j,{value:"dark-theme",label:Z("Dark")}),(0,y.jsx)(v.j,{value:"light-theme",label:Z("Light")}),(0,y.jsx)(v.j,{value:"white-theme",label:Z("White")})]})})]}),(0,y.jsx)(d.E,{children:(0,y.jsx)("button",{ref:this.resetButtonRef,className:"pf-c-button pf-m-secondary terminal-reset",onClick:this.onResetClick,children:Z("Reset")})})]})})]}),(0,y.jsx)("div",{className:"terminal-body "+this.state.theme,id:"the-terminal",children:e})]})}}]),n}(s.Component),I=E,L=function(e){return(0,y.jsx)("div",{className:"ct-page-fill",id:"terminal",children:(0,y.jsx)(I,{})})}}}]);
//# sourceMappingURL=391.bc73db89.chunk.js.map